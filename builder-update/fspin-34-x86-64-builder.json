{
  "builders": [
    {
      "type": "googlecompute",
      "project_id": "fspin-265404",
      "source_image_family": "fspin-34",
      "ssh_username": "packer",
      "use_os_login": "true",
      "temporary_key_pair_type": "ed25519",
      "zone": "us-west2-a",
      "name": "fspin-34-x86-64-${SNAPSHOT_ID}",
      "image_name": "fspin-34-x86-64-${SNAPSHOT_ID}",
      "disk_type": "pd-ssd",
      "disk_size": "30",
      "machine_type": "e2-standard-4"
    }
  ],
  "provisioners": [
    {
     "type": "file",
     "source": "/opt",
     "destination": "/tmp"
    },
    {
      "type": "shell",
      "inline": [
	"sudo cp -r /tmp/opt/* /opt/",
	"sudo dnf -y clean all",
	"sudo dnf -y config-manager --set-disabled '*'",
	"sudo cp /opt/fspin-snapshot.repo /etc/yum.repos.d/",
	"sudo dnf -y config-manager --set-enabled 'fspin-*' google-cloud-sdk",
        "sudo dnf -y update",
	"sudo dnf -y install vim-enhanced mock qemu-user-static transmission-cli git pykickstart",
	"sudo sed -i 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/selinux/config",
	"sudo grub2-install /dev/sda",
	"sudo grub2-mkconfig -o /boot/grub2/grub.cfg",
	"sudo cp /opt/mock-snapshot-fspin-f34-x86_64.cfg /etc/mock/fspin-snapshot-x86_64.cfg"
      ]
    }
  ]
}
