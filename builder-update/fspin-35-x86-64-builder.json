{
  "builders": [
    {
      "type": "googlecompute",
      "project_id": "fspin-7ce15ff175",
      "image_family": "fspin",
      "source_image_project_id": "fedora-cloud",
      "source_image_family": "fedora-cloud-35",
      "ssh_username": "packer",
      "use_os_login": "true",
      "temporary_key_pair_type": "ed25519",
      "zone": "us-central1-a",
      "name": "fspin-35-x86-64-${SNAPSHOT_ID}",
      "image_name": "fspin-35-x86-64-${SNAPSHOT_ID}",
      "disk_type": "pd-ssd",
      "disk_size": "30",
      "machine_type": "e2-standard-4"
    }
  ],
  "provisioners": [
    {
     "type": "file",
     "source": "/opt",
     "destination": "/tmp"
    },
    {
      "type": "shell",
      "inline": [
	"sudo cp -r /tmp/opt/* /opt/",
	"sudo dnf -y clean all",
	"sudo dnf -y config-manager --set-disabled '*'",
	"sudo cp /opt/fspin-snapshot.repo /etc/yum.repos.d/",
	"sudo dnf -y config-manager --set-enabled 'fspin-*'",
        "sudo dnf -y update",
	"sudo dnf -y install vim-enhanced mock qemu-user-static transmission-cli git pykickstart",
	"sudo sed -i 's/SELINUX=enforcing/SELINUX=permissive/g' /etc/selinux/config",
	"sudo cp /opt/mock-snapshot-fspin-f35-x86_64.cfg /etc/mock/fspin-snapshot-x86_64.cfg"
      ]
    }
  ]
}
